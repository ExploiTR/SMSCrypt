package app.exploitr.sec.scrypt.messages;

import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteException;
import android.net.Uri;
import android.telephony.SmsManager;

import java.util.ArrayList;

import app.exploitr.sec.scrypt.models.MessageFormat;

public class SMSRecordManager {
    private static final String SMS_URI_INBOX = "content://sms/inbox";
    private static final String SMS_URI_ALL = "content://sms/";

    public static void sendMessage(String receiver, String content) {
        //todo
    }

    public static MessageFormat getMessage(String sender, String filter, Context context) {
        ArrayList<MessageFormat> messages = readMessage(sender, context);
        for (MessageFormat message : messages) {
            String body;
            if ((body = message.getBody()).contains(filter)) {
                return message;
            }
        }
        return null;
    }

    public static ArrayList<MessageFormat> readMessage(String sender, Context context) {
        ArrayList<MessageFormat> results = new ArrayList<>();
        try {
            Uri uri = Uri.parse(SMS_URI_INBOX);
            String[] projection = new String[]{"_id", "address", "body", "date"};
            Cursor cur = context.getContentResolver().query(uri, projection, "address=" + sender, null, "date desc");
            if (cur != null && cur.moveToFirst()) {
                int index_id = cur.getColumnIndex("_id");
                int index_Body = cur.getColumnIndex("body");
                int index_Address = cur.getColumnIndex("address");
                do {
                    results.add(MessageFormat.create(cur.getInt(index_id), cur.getString(index_Body), cur.getString(index_Address)));
                } while (cur.moveToNext());

                if (!cur.isClosed()) {
                    cur.close();
                    cur = null;
                }
            }
        } catch (SQLiteException ex) {
            ex.printStackTrace();
        }
        return results;
    }

    public static void deleteMessage(int id) {
        SmsManager manager;

    }
}
