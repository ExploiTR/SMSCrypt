package app.exploitr.sec.scrypt.contacts;

import static contacts.core.ContactsKt.Contacts;
import static contacts.core.OrderByKt.asc;
import static contacts.core.WhereKt.equalTo;

import android.content.Context;
import android.os.Handler;
import android.os.Looper;

import java.util.List;

import contacts.core.ContactsFields;
import contacts.core.Fields;
import contacts.core.entities.Contact;

public class ContactManagerLegacy {

    /**
     * Warning : Only use for initial caching.
     * <p><p/>
     * Asynchronously retrieves an array of all contacts from the device and invokes the provided listener
     * upon completion.
     * This method operates on a separate thread to avoid blocking the main thread.
     * But result is returned on the main thread.
     *
     * @param context  The application context.
     * @param listener The listener to be notified when the contacts retrieval is complete.
     */
    public static void getContacts(Context context, ContactLoadingListener listener) {
        new Thread(() -> {
            var contacts = Contacts(context)
                    .query()
                    .where(equalTo(Fields.Contact.HasPhoneNumber, true))
                    .orderBy(asc(ContactsFields.DisplayNamePrimary))
                    .find();
            new Handler(Looper.getMainLooper()).post(() -> listener.onLoadComplete(contacts));
        }).start();
    }

    public interface ContactLoadingListener {
        void onLoadComplete(List<Contact> phoneNumbers);
    }
}
