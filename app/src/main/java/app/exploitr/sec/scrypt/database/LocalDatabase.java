package app.exploitr.sec.scrypt.database;

import android.content.Context;
import android.content.SharedPreferences;

import androidx.preference.PreferenceManager;

import java.security.GeneralSecurityException;

import app.exploitr.sec.scrypt.security.AESUtil;

public class LocalDatabase {
    private static SharedPreferences preferenceManager;
    private static LocalDatabase database;

    private final String CONST_ALIAS = "l2u&$260YZi";
    private final String CONST_PHONE = "kV5wY9e#822";
    private final String MASTER_PWD_CHK = "#H5q1#g9N3#";
    private final String VERIFY_MASTER_PWD_STR = "X5Zekl@uZ76";
    private final String LOCKOUT = "f9L@2!a5u7V";

    private LocalDatabase() {
    }

    public static LocalDatabase getInstance(Context context) {
        if (database == null || preferenceManager == null) {
            preferenceManager = PreferenceManager.getDefaultSharedPreferences(context);
            return database = new LocalDatabase();
        }
        return database;
    }

    public void setAlias(String alias) {
        preferenceManager.edit().putString(CONST_ALIAS, alias).apply();
    }

    public void setPhone(String phone) {
        preferenceManager.edit().putString(CONST_PHONE, phone).apply();
    }

    public void setMasterPasswordEncryptedText(String masterPwd) throws GeneralSecurityException {
        preferenceManager.edit().putString(MASTER_PWD_CHK, AESUtil.encrypt(masterPwd, VERIFY_MASTER_PWD_STR)).apply();
    }

    public String getAlias() {
        return preferenceManager.getString(CONST_ALIAS, "?");
    }

    public String getPhone() {
        return preferenceManager.getString(CONST_PHONE, "");
    }

    public boolean getMasterPasswordVerificationTestSuccess(String masterPwd) throws GeneralSecurityException {
        return VERIFY_MASTER_PWD_STR.equals(AESUtil.decrypt(masterPwd, preferenceManager.getString(MASTER_PWD_CHK, null)));
    }
}
